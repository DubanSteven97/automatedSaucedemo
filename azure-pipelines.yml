trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
# Instalar Chrome 
- script: |
    sudo apt-get update
    sudo apt-get install -y chromium-browser
  displayName: 'Install Chromium'

- script: |
    CHROME_DRIVER_VERSION=$(curl -sS https://chromedriver.storage.googleapis.com/LATEST_RELEASE)
    wget -N https://chromedriver.storage.googleapis.com/$CHROME_DRIVER_VERSION/chromedriver_linux64.zip
    unzip chromedriver_linux64.zip
    sudo mv chromedriver /usr/local/bin/chromedriver
    sudo chmod +x /usr/local/bin/chromedriver
  displayName: 'Install ChromeDriver'

# Instalar Firefox 
- script: |
    sudo apt-get install -y firefox
  displayName: 'Install Firefox'

- script: |
    GECKO_VERSION=$(curl -s https://api.github.com/repos/mozilla/geckodriver/releases/latest | grep '"tag_name":' | sed -E 's/.*"([^"]+)".*/\1/')
    wget https://github.com/mozilla/geckodriver/releases/download/$GECKO_VERSION/geckodriver-$GECKO_VERSION-linux64.tar.gz
    tar -xzf geckodriver-$GECKO_VERSION-linux64.tar.gz
    sudo mv geckodriver /usr/local/bin/
    sudo chmod +x /usr/local/bin/geckodriver
  displayName: 'Install GeckoDriver'

- task: Maven@3
  inputs:
    mavenPomFile: 'pom.xml'
    mavenOptions: '-Xmx3072m'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '1.17'
    jdkArchitectureOption: 'x64'
    publishJUnitResults: true
    testResultsFiles: '**/surefire-reports/TEST-*.xml'
    goals: 'clean verify serenity:aggregate'

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: 'target/site/serenity'
    ArtifactName: 'SerenityReport'
    publishLocation: 'Container'
